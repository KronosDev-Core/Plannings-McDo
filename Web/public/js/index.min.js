function getFormatInputTime(time){var H=time.split(":")[0],m=time.split(":")[1],res="";return 1==H.length?res+=`0${H}`:res+=H,res+=":",1==m.length?res+=`0${m}`:res+=m,res}function ToFormatInputTime(time){return`${time.substring(0,2)}:${time.substring(2,4)}`}function ToFormatCardFromTable(data){return data.replaceAll("<p>","").replaceAll("</p>","").replaceAll('<hr class="dropdown-divider">'," ; ").replaceAll(/\n/gm,"").replaceAll("                    ","").replaceAll(/^ /gm,"")}function GetDataTable(FullName,id,HourMonday,HourTuesday,HourWednesday,HourThursday,HourFriday,HourSaturday,HourSunday,href){return{FullName:FullName=href.children[1].innerHTML,id:id=href.children[0].innerHTML,HourMonday:HourMonday=ToFormatCardFromTable(href.children[2].innerHTML),HourTuesday:HourTuesday=ToFormatCardFromTable(href.children[3].innerHTML),HourWednesday:HourWednesday=ToFormatCardFromTable(href.children[4].innerHTML),HourThursday:HourThursday=ToFormatCardFromTable(href.children[5].innerHTML),HourFriday:HourFriday=ToFormatCardFromTable(href.children[6].innerHTML),HourSaturday:HourSaturday=ToFormatCardFromTable(href.children[7].innerHTML),HourSunday:HourSunday=ToFormatCardFromTable(href.children[8].innerHTML)}}function getRangeWeek(date){if(null!=date)var curr=new Date(date);else var curr=new Date((new Date).toDateString());if(0!=curr.getDay())var first=curr.getDate()-curr.getDay()+1;else var first=curr.getDate()-6;if(0!=curr.getDay())var last=curr.getDate()+6;else var last=curr.getDate();return[new Date(curr.setDate(first)),new Date(curr.setDate(last))]}function FormatCompactDate(date,type="day"){return"day"==type?date.getDate()>9?date.getDate():"0"+date.getDate():date.getMonth()>9?date.getMonth()+1:"0"+(date.getMonth()+1)}Date.prototype.FormatYMD=function(){var date=new Date(this.valueOf()),res=`${date.getFullYear()}`;return 1==String(date.getMonth()+1).length?res+=`-0${date.getMonth()+1}`:res+=`-${date.getMonth()+1}`,1==String(date.getDate()).length?res+=`-0${date.getDate()}`:res+=`-${date.getDate()}`,res},Array.prototype.last=function(){return this[this.length-1]},kronos(()=>{let Week,StartWeek;localStorage.removeItem("employee");let EmployeTableLine={},DataPreSortTable={};function TitleWeek(){var _=getRangeWeek(),StartWeek=_[0],EndWeek=_[1];Week=_,localStorage.setItem("CurrentWeek",Week[0].getTime()),kronos(HREF.TitleTableCard).html(`Semaine du ${FormatCompactDate(StartWeek)}/${StartWeek.getMonth()>9?EndWeek.getMonth()+1:"0"+(EndWeek.getMonth()+1)} au ${FormatCompactDate(EndWeek)}/${EndWeek.getMonth()>9?EndWeek.getMonth()+1:"0"+(EndWeek.getMonth()+1)}`)}TitleWeek(),Boolean(localStorage.getItem("ADMIN"))?kronos(HREF.DivFormCardFooter).html(HTML.DivFormCardFooterHtmlForm):kronos(HREF.DivFormCardFooter).remove(),kronos().request("POST","/Employe",{type:"get"},data=>{data.forEach((elem,index)=>{kronos(HREF.BodyTable).append(HTML.TemplateLineTable(elem)),EmployeTableLine[elem.id]=index,DataPreSortTable[elem.id]={}}),kronos().request("POST","/Horaire",{type:"get",week:Week[0].getTime()},data=>{data.forEach((elem,index)=>{-1!==Object.keys(DataPreSortTable[elem.EmployePlanning]).indexOf(elem.DayDate)?DataPreSortTable[elem.EmployePlanning][elem.DayDate].push(elem):DataPreSortTable[elem.EmployePlanning][elem.DayDate]=[elem]}),Object.keys(DataPreSortTable).forEach((elem,index)=>{0!==Object.keys(DataPreSortTable[elem]).length&&Object.keys(DataPreSortTable[elem]).forEach((elemDate,indexDate)=>{if(1===DataPreSortTable[elem][elemDate].length)DataPreSortTable[elem][elemDate][0].Absent?kronos(HREF.TableSpecificLine({row:EmployeTableLine[elem]+1,column:DATA.DayWeekDataTable[new Date(Number(elemDate)).getDay()]})).html("<p>Abs</p>"):kronos(HREF.TableSpecificLine({row:EmployeTableLine[elem]+1,column:DATA.DayWeekDataTable[new Date(Number(elemDate)).getDay()]})).append(FUNCTION.ConvertTimeTable(DataPreSortTable[elem][elemDate][0].StartHour.replace(".",":")+" - "+DataPreSortTable[elem][elemDate][0].EndHour.replace(".",":")));else{var AllHourDay="";DataPreSortTable[elem][elemDate].forEach((elemData,indexData)=>{DataPreSortTable[elem][elemDate][0].Absent?kronos(HREF.TableSpecificLine({row:EmployeTableLine[elem]+1,column:DATA.DayWeekDataTable[new Date(Number(elemDate)).getDay()]})).html("<p>Abs</p>"):""!==AllHourDay?AllHourDay+=`;${DataPreSortTable[elem][elemDate][indexData].StartHour.replace(".",":")} - ${DataPreSortTable[elem][elemDate][indexData].EndHour.replace(".",":")}`:AllHourDay=`${DataPreSortTable[elem][elemDate][indexData].StartHour.replace(".",":")} - ${DataPreSortTable[elem][elemDate][indexData].EndHour.replace(".",":")}`}),""!==AllHourDay&&kronos(HREF.TableSpecificLine({row:EmployeTableLine[elem]+1,column:DATA.DayWeekDataTable[new Date(Number(elemDate)).getDay()]})).html(FUNCTION.ConvertTimeTable(AllHourDay))}})}),kronos(HREF.RowTableCard).forEach(elem=>{elem.addEventListener("click",event=>{console.log(event,Boolean(localStorage.getItem("ADMIN")));var FullName="",id="",HourMonday="",HourTuesday="",HourWednesday="",HourThursday="",HourFriday="",HourSaturday="",HourSunday="";if(Boolean(localStorage.getItem("ADMIN"))){if(kronos(HREF.ListUniqueWorkerHeader).html(""),kronos(HREF.InputFormID).value(null),kronos(HREF.InputFormCheckAbsent).value(!1),kronos(HREF.InputFormDate).value(""),"TD"==event.target.tagName||"TH"==event.target.tagName)FullName=`${event.path[1].children[1].innerHTML}`,id=event.path[1].children[0].innerHTML;else if("P"==event.target.tagName||"HR"==event.target.tagName){FullName=`${event.path[2].children[1].innerHTML}`,id=event.path[2].children[0].innerHTML;var curr=new Date,Select=curr.getDate()-curr.getDay()+1+(event.path[1].cellIndex-2),daySelect=new Date(curr.setDate(Select));if(kronos(HREF.InputFormDate).value(daySelect.FormatYMD()),"P"==event.target.tagName){var dataTime=event.target.innerHTML;kronos(HREF.InputFormTimeStart).value(getFormatInputTime(dataTime.split(" - ")[0])),kronos(HREF.InputFormTimeEnd).value(getFormatInputTime(dataTime.split(" - ")[1]))}}else"TR"==event.target.tagName&&(FullName=`${event.target.children[1].innerHTML}`,id=event.target.children[0].innerHTML);kronos(HREF.InputFormID).value(Number(id))}else"TD"==event.target.tagName||"TH"==event.target.tagName?({FullName:FullName,id:id,HourMonday:HourMonday,HourTuesday:HourTuesday,HourWednesday:HourWednesday,HourThursday:HourThursday,HourFriday:HourFriday,HourSaturday:HourSaturday,HourSunday:HourSunday}=GetDataTable(FullName,event,id,HourMonday,HourTuesday,HourWednesday,HourThursday,HourFriday,HourSaturday,HourSunday,event.path[1])):"P"==event.target.tagName||"HR"==event.target.tagName?({FullName:FullName,id:id,HourMonday:HourMonday,HourTuesday:HourTuesday,HourWednesday:HourWednesday,HourThursday:HourThursday,HourFriday:HourFriday,HourSaturday:HourSaturday,HourSunday:HourSunday}=GetDataTable(FullName,event,id,HourMonday,HourTuesday,HourWednesday,HourThursday,HourFriday,HourSaturday,HourSunday,event.path[2])):"TR"==event.target.tagName&&({FullName:FullName,id:id,HourMonday:HourMonday,HourTuesday:HourTuesday,HourWednesday:HourWednesday,HourThursday:HourThursday,HourFriday:HourFriday,HourSaturday:HourSaturday,HourSunday:HourSunday}=GetDataTable(FullName,event,id,HourMonday,HourTuesday,HourWednesday,HourThursday,HourFriday,HourSaturday,HourSunday,event.target)),console.log(FullName,id,"\n",HourMonday,"\n",HourTuesday,"\n",HourWednesday,"\n",HourThursday,"\n",HourFriday,"\n",HourSaturday,"\n",HourSunday);kronos(HREF.ListUniqueWorkerHeader).html(FullName)})})})}),kronos().request("POST","/Employe",{type:"get"},data=>{data.forEach(elem=>{kronos(HREF.InputSelectEmployee).append(HTML.SelectOptionEmployee(elem))}),kronos(HREF.InputSelectEmployee).on("change",event=>{kronos(HREF.DivNextAdminForm).html(""),kronos(HREF.DivAdminSubOption).html(""),"new"!==event.target.value?kronos().request("POST","/Employe",{type:"getOne",id:event.target.value},data=>{localStorage.setItem("employee",JSON.stringify(data)),kronos(HREF.DivAdminOption).html(HTML.AdminFormOption),kronos(HREF.InputSelectOption).on("change",event=>{kronos(HREF.DivNextAdminForm).html(""),kronos(HREF.DivAdminSubOption).html(""),"EditEmp"===event.target.value&&(kronos(HREF.DivNextAdminForm).html(HTML.TemplateFormEmployee({type:"edit",id:Number(JSON.parse(localStorage.getItem("employee")).id),value:JSON.parse(localStorage.getItem("employee"))})),kronos(HREF.ButtonDeleteEmployee).on("click",event=>{kronos().request("POST","/Employe",{type:"remove",id:JSON.parse(localStorage.getItem("employee")).id},data=>{}),window.location.reload()})),"NewWor"===event.target.value&&(kronos(HREF.DivNextAdminForm).html(HTML.TemplateFormTimeWork({type:"new",id:Number(JSON.parse(localStorage.getItem("employee")).id),StartWeek:Week[0]})),kronos("div#NextAdmin > form > input:nth-child(2)").on("change",event=>{event.target.value="new"}),kronos(HREF.InputFormCheckAbsent).on("change",event=>{kronos(HREF.InputFormTimeStart).attr("toggle","disabled"),kronos(HREF.InputFormTimeEnd).attr("toggle","disabled")}),kronos(HREF.InputFormDate).on("change",event=>{kronos(HREF.InputFormStartWeek).value(String(getRangeWeek(new Date(event.target.value))[0].setHours(0)))})),"EditWor"===event.target.value&&(kronos(HREF.DivAdminSubOption).html(HTML.AdminFormSubOption),kronos().request("POST","/Horaire",{type:"get",subtype:"employe",week:Week[0].getTime(),id:Number(JSON.parse(localStorage.getItem("employee")).id)},data=>{data.forEach(elem=>{kronos(HREF.InputSelectSubOption).append(HTML.SelectOptionTimeWork(elem))}),kronos(HREF.InputSelectSubOption).on("change",event=>{kronos().request("POST","/Horaire",{type:"get",id:Number(event.target.value)},data=>{kronos(HREF.DivNextAdminForm).html(HTML.TemplateFormTimeWork({type:"edit",id:Number(JSON.parse(localStorage.getItem("employee")).id),value:data[0],StartWeek:Week[0]})),kronos(HREF.InputFormDate).on("change",event=>{kronos(HREF.InputFormStartWeek).value(String(getRangeWeek(new Date(event.target.value))[0].setHours(0)))}),kronos(HREF.InputFormCheckAbsent).on("change",event=>{kronos(HREF.InputFormTimeStart).attr("toggle","disabled"),kronos(HREF.InputFormTimeEnd).attr("toggle","disabled")})})})}))})}):"new"===event.target.value&&(localStorage.removeItem("employee"),kronos(HREF.DivNextAdminForm).html(HTML.TemplateFormEmployee({type:"new"})))})}),kronos(HREF.ListUniqueWorkerButton).forEach(elem=>elem.addEventListener("click",event=>{void 0!==event.target.ownerSVGElement&&null!=event.target.ownerSVGElement?event.target.ownerSVGElement.classList.toggle(HREF.AnimationArrow):"svg"===event.target.tagName?event.target.classList.toggle(HREF.AnimationArrow):"DIV"===event.target.tagName?event.target.nextElementSibling.classList.toggle(HREF.AnimationArrow):event.target.children[1].classList.toggle(HREF.AnimationArrow)}))});